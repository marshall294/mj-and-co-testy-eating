<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MJ & CO — Admin</title>
<!-- Favicon -->
<link rel="icon" type="image/png" href="logo.jpg">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --accent:#ff7a00;
      --accent-2:#ff4d00;
      --muted:#6b7280;
      --bg:#fff8f2;
      --card:#ffffff;
      --glass: rgba(255,255,255,0.7);
      --radius:16px;
      --maxw:1400px;
      --shadow: 0 10px 30px rgba(16,24,40,0.08);
      color-scheme: light;
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, Arial;
    }

    *{box-sizing:border-box}
    html,body{height:100%; margin:0; background:var(--bg); font-family:inherit; color:#0f172a;}
    body{display:flex; flex-direction:column;}

    header.top{display:flex; align-items:center; gap:12px; padding:16px 24px; background:#fff; box-shadow:var(--shadow);}
    .logo{width:60px; height:60px; border-radius:12px; object-fit:cover;}
    header.top h1{margin:0; font-size:22px; font-weight:700;}

    .wrap{display:flex; max-width:var(--maxw); margin:24px auto; gap:24px;}
    aside.sidebar{width:260px; flex-shrink:0;}
    .sidebar .card{padding:20px; display:flex; flex-direction:column; gap:16px; position:sticky; top:24px;}
    .sidebar .nav-item{padding:10px 14px; border-radius:12px; cursor:pointer; transition:0.2s; font-weight:600;}
    .sidebar .nav-item:hover, .sidebar .nav-item.active{background:var(--accent); color:#fff;}

    main.content{flex:1;}
    .stats{display:flex; gap:16px; flex-wrap:wrap; margin-bottom:16px;}
    .stat-card{flex:1; min-width:120px; background:var(--card); padding:14px 18px; border-radius:var(--radius); box-shadow:var(--shadow); text-align:center;}
    .stat-card h2{margin:0; font-size:18px; color:var(--accent);}
    .stat-card p{margin:6px 0 0; font-size:14px; color:var(--muted);}

    .controls{display:flex; gap:12px; margin-bottom:12px; flex-wrap:wrap;}
    .controls input, .controls select{padding:10px 12px; border-radius:10px; border:1px solid rgba(0,0,0,0.1); font-size:14px;}

    table{width:100%; border-collapse:collapse; background:var(--card); border-radius:var(--radius); overflow:hidden; box-shadow:var(--shadow);}
    table th, table td{padding:12px 14px; text-align:left; font-size:14px; border-bottom:1px solid rgba(0,0,0,0.08);}
    table th{background:rgba(255,122,0,0.1);}
    table tr:last-child td{border-bottom:none;}
    .btn{padding:6px 12px; border-radius:10px; border:0; cursor:pointer; font-weight:600; transition:0.2s;}
    .btn.view{background:#2563eb;color:#fff;}
    .btn.complete{background:#16a34a;color:#fff;}
    .btn.delete{background:#b91c1c;color:#fff;}

    /* modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:100;}
    .modal .box{background:#fff;padding:20px;border-radius:12px;max-width:600px;width:90%; max-height:90%; overflow:auto;}
    .modal h3{margin-top:0;}
    .modal .close{float:right; cursor:pointer; font-size:18px; font-weight:700;}
    @media (max-width:980px){ .wrap{flex-direction:column;} .sidebar{width:100%;} }

  </style>
</head>
<body>

<header class="top">
  <img class="logo" src="logo.jpg" alt="MJ & CO logo" />
  <h1>MJ & CO — Admin Dashboard</h1>
</header>

<div class="wrap">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="card">
      <div class="nav-item active" data-view="orders">Orders</div>
      <div class="nav-item" data-view="stats">Statistics</div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="content">
    <div class="stats" id="statsCards">
      <div class="stat-card">
        <h2 id="totalOrders">0</h2>
        <p>Total Orders</p>
      </div>
      <div class="stat-card">
        <h2 id="pendingOrders">0</h2>
        <p>Pending</p>
      </div>
      <div class="stat-card">
        <h2 id="completedOrders">0</h2>
        <p>Completed</p>
      </div>
    </div>

    <div class="controls">
      <input type="text" id="searchOrders" placeholder="Search by name or order ID..." />
      <select id="filterStatus">
        <option value="all">All Status</option>
        <option value="pending">Pending</option>
        <option value="completed">Completed</option>
      </select>
    </div>

    <table>
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Name</th>
          <th>Total</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="ordersTableBody">
        <!-- Orders populated via JS -->
      </tbody>
    </table>
  </main>
</div>

<!-- Modal -->
<div class="modal" id="orderModal">
  <div class="box">
    <span class="close" id="closeModal">&times;</span>
    <h3>Order Details</h3>
    <div id="modalContent"></div>
  </div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref as dbRef, onValue, update, remove } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBSM1gw5QpHJ6PMPG9gCuYDQ9WZ4MUcu0A",
  authDomain: "hotel-5c90a.firebaseapp.com",
  databaseURL: "https://hotel-5c90a-default-rtdb.firebaseio.com",
  projectId: "hotel-5c90a",
  storageBucket: "hotel-5c90a.appspot.com",
  messagingSenderId: "1018416176032",
  appId: "1:1018416176032:web:2f57a167fa1106c8b022c5"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const ordersTableBody = document.getElementById('ordersTableBody');
const totalOrdersEl = document.getElementById('totalOrders');
const pendingOrdersEl = document.getElementById('pendingOrders');
const completedOrdersEl = document.getElementById('completedOrders');
const searchEl = document.getElementById('searchOrders');
const filterEl = document.getElementById('filterStatus');

let allOrders = {};

// Load orders
const ordersRef = dbRef(db,'orders');
onValue(ordersRef, snapshot => {
  allOrders = snapshot.val() || {};
  renderOrders();
});

function renderOrders(){
  ordersTableBody.innerHTML='';
  let total=0, pending=0, completed=0;
  const filterText = searchEl.value.toLowerCase();
  const statusFilter = filterEl.value;

  Object.entries(allOrders).forEach(([key, order])=>{
    total++;
    if(order.status==='pending') pending++;
    if(order.status==='completed') completed++;

    if(statusFilter!=='all' && order.status!==statusFilter) return;
    if(filterText && !order.name.toLowerCase().includes(filterText) && !order.orderID.toLowerCase().includes(filterText)) return;

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${order.orderID}</td>
      <td>${order.name}</td>
      <td>₦${order.total.toLocaleString()}</td>
      <td>${order.status}</td>
      <td>
        <button class="btn view" data-id="${key}">View</button>
        <button class="btn complete" data-id="${key}">Complete</button>
        <button class="btn delete" data-id="${key}">Delete</button>
      </td>
    `;
    ordersTableBody.appendChild(tr);
  });

  totalOrdersEl.textContent = total;
  pendingOrdersEl.textContent = pending;
  completedOrdersEl.textContent = completed;

  // Attach buttons
  document.querySelectorAll('.btn.view').forEach(btn=>{
    btn.onclick=()=>openModal(allOrders[btn.dataset.id]);
  });
  document.querySelectorAll('.btn.complete').forEach(btn=>{
    btn.onclick=()=>markComplete(btn.dataset.id);
  });
  document.querySelectorAll('.btn.delete').forEach(btn=>{
    btn.onclick=()=>deleteOrder(btn.dataset.id);
  });
}

searchEl.oninput = renderOrders;
filterEl.onchange = renderOrders;

// modal
const modal = document.getElementById('orderModal');
const modalContent = document.getElementById('modalContent');
const closeModalBtn = document.getElementById('closeModal');
closeModalBtn.onclick=()=>{ modal.style.display='none'; };
window.onclick=e=>{ if(e.target===modal) modal.style.display='none'; }

function openModal(order){
  modalContent.innerHTML = `
    <p><strong>Order ID:</strong> ${order.orderID}</p>
    <p><strong>Name:</strong> ${order.name}</p>
    <p><strong>Phone:</strong> ${order.phone}</p>
    <p><strong>Fulfillment:</strong> ${order.fulfillment}</p>
    <p><strong>Address:</strong> ${order.address}</p>
    <p><strong>Total:</strong> ₦${order.total.toLocaleString()}</p>
    <p><strong>Status:</strong> ${order.status}</p>
    <h4>Items:</h4>
    <ul>${order.items.map(it=>`<li>${it.title} × ${it.qty} = ₦${(it.price*it.qty).toLocaleString()}</li>`).join('')}</ul>
    <p><strong>Instructions:</strong> ${order.instructions || 'None'}</p>
  `;
  modal.style.display='flex';
}

function markComplete(id){
  update(dbRef(db,'orders/'+id), { status:'completed' });
}

function deleteOrder(id){
  if(confirm('Are you sure you want to delete this order?')) remove(dbRef(db,'orders/'+id));
}
</script>

</body>
</html>
